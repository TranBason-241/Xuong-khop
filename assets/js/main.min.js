$(document).ready(function () {
  listNavItem = document.querySelectorAll(".nav-item");
  isPc = true;

  if (window.innerWidth < 577) {
    isPc = false;
  }

  var swiper = new Swiper(".mySwiper", {
    spaceBetween: 30,
    effect: "fade",
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    on: {
      slideChange: function () {
        currentSlide = this.slides[this.activeIndex];
        // resetAosModal(currentSlide);
        document.querySelector(".nav-item.active")?.classList.remove("active");

        targetIndex = 0;
        if (this.activeIndex == 0) {
          targetIndex = 5;
        } else {
          targetIndex = this.activeIndex - 1;
        }
        listNavItem[targetIndex].classList.add("active");
      },
      slideChangeTransitionStart: function () {
        $(".swiper-slide-active [data-aos]").addClass("my-hide");
        $(".swiper-slide-active [data-aos]").removeClass("aos-init").removeClass("aos-animate");
      },
      slideChangeTransitionEnd: function () {
        $(".swiper-slide-active [data-aos]").removeClass("my-hide");
        AOS.init();
      },
    },
  });

  // Menu

  listNavItem.forEach((navItem) => {
    navItem.addEventListener("click", () => {
      index = Number(navItem.getAttribute("value"));

      swiper.slideTo(index);
    });
  });

  let currentSlide = swiper.slides[0];

  nextAction = () => {
    currentItemActions = [];
    currentItemActions = currentSlide.querySelectorAll(".action");

    if (currentItemActions.length < 1) {
      //Trang không có action => next slide swiper
      swiper.slideNext();
    } else {
      // Có action

      // itemActionToShow = currentSlide.querySelector(".action:not(.show)");
      // if (itemActionToShow !== null) {
      //   itemActionToShow.classList.add("show");
      // } else {
      //   // Hết action để show => qua trang
      //   swiper.slideNext();
      // }

      // Chỉ dành cho slide 5

      currentItemAction = currentSlide.querySelector(".action.show");
      currentIndexAction = Number(currentItemAction.getAttribute("index")) + 1;
      nextItemAction = document.querySelector(`.content-item.action[index="${currentIndexAction}"]`);
      if (nextItemAction !== null) {
        currentItemAction.classList.remove("show");
        nextItemAction.classList.add("show");
      }
    }
  };

  prevAction = () => {
    currentItemActions = [];
    currentItemActions = currentSlide.querySelectorAll(".action");

    if (currentItemActions.length < 1) {
      //Trang không có action => next slide swiper
      swiper.slidePrev();
    } else {
      // Chỉ dành cho slide 5

      currentItemAction = currentSlide.querySelector(".action.show");
      currentIndexAction = Number(currentItemAction.getAttribute("index")) - 1;
      nextItemAction = document.querySelector(`.content-item.action[index="${currentIndexAction}"]`);
      if (nextItemAction !== null) {
        currentItemAction.classList.remove("show");
        nextItemAction.classList.add("show");
      } else {
        swiper.slidePrev();
      }
    }
  };

  // Sử lí change slide

  canScroll = true;
  canChangeSlise = false;
  if (isPc) {
    document.addEventListener("wheel", function (event) {
      if (canScroll) {
        canScroll = false;
        if (event.deltaY > 0) {
          canScroll = false;
          console.log("Lăn chuột xuống");
          nextAction();
        } else {
          console.log("Lăn chuột lên");
          prevAction();
        }
        setTimeout(() => {
          canScroll = true;
        }, 500);
      }
    });
  }

  resetAosModal = (currentSlides) => {
    setTimeout(() => {
      // var currentSlides = document.querySelectorAll(`.${element} [data-aos]`);
      var elements = currentSlides.querySelectorAll(`[data-aos]`);
      elements.forEach(function (element) {
        element.classList.remove("aos-animate");
        element.classList.remove("aos-init");
      });

      setTimeout(() => {
        AOS.refresh();
      }, 1000);
    });
  };
});

// write function convert string to number

// write function change background when click on button has id = "haha"
